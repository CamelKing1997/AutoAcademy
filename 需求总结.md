# FAMSUN Academy 自动学习系统 - 完整需求总结

**项目时间**: 2025年10月20日  
**开发环境**: Conda环境 `fs_dev_ts_gpu`  
**编程语言**: Python 3.8+  

---

## 📋 核心需求清单

### 1. 基础功能需求

#### 1.1 自动登录
- **账号**: `60012932`
- **密码**: `F.smm970406`
- **登录页**: https://academy.famsungroup.com/login.html
- **要求**: 
  - 自动填写账号密码
  - 模拟人类输入（逐字符输入，随机延迟）
  - 处理各种登录页面变化
  - 反自动化检测（去除webdriver标识）

#### 1.2 课程自动播放
- **视频课程**:
  - 自动点击播放
  - 设置2倍速播放（提高效率）
  - 自动翻页/下一节
  
- **文档课程**:
  - 自动翻页浏览
  - 快速滚动查看内容

---

### 2. 核心约束条件 ⭐⭐⭐

#### 2.1 倒计时强制等待 (关键需求)
- **场景**: 每个课程都有学习时长要求
- **表现**: 页面显示倒计时，例如："还需 19分钟 12秒"
- **约束**: 
  - ❌ **不能跳过倒计时**
  - ❌ **不能关闭页面提前结束**
  - ❌ **不能通过JS操作时间**
  - ✅ **必须等待倒计时自然倒数到0**
  
- **策略**: 
  - 视频开启2倍速播放（节省时间）
  - 倒计时仍按正常速度倒数（不受倍速影响）
  - 程序需实时监控倒计时，等待结束后才能进入下一课程

- **实现要点**:
  ```python
  # 倒计时检测示例
  countdown_text = "还需 19分钟 12秒"
  # 解析为: 19*60 + 12 = 1152秒
  # 每10秒检查一次倒计时
  # 当倒计时为0时，课程完成
  ```

---

### 3. 积分系统需求 ⭐⭐⭐

#### 3.1 目标设定
- **年度目标**: 本年累计 **60学分**
- **积分页面**: https://academy.famsungroup.com/ssp/#/credit/userdetail
- **显示信息**:
  - 本年排名
  - 本月新增
  - **本年累计** ← 核心数据
  - 历史累计

#### 3.2 智能策略

**优先级排序**:
```
课程按积分从高到低排序
示例：
  1. 课程A (5学分) ← 优先学习
  2. 课程B (3学分)
  3. 课程C (1学分)
  4. 课程D (0.5学分) ← 最后学习
```

**智能停止机制**:
```python
当前积分 = 45分 (查询积分页面获得)
已学完课程获得 = 15分
预计总分 = 45 + 15 = 60分

if 预计总分 >= 60:
    停止学习  # 达到目标，节省时间
```

**效率分析**:
- 不使用智能策略: 可能需要学完全部100个课程
- 使用智能策略: 只需学完20个高分课程即可达标
- **节省时间**: 约70%

#### 3.3 实时进度显示
```
学习进度日志示例：
[1/50] 开始学习: 安全管理课程 (+5分)
⏱️  检测到学习时长要求: 需等待 1200秒
⏰ 预计需要等待: 20分0秒
✅ 倒计时已结束！
✓ 课程完成
🎯 获得积分: +5 | 累计已获得: 5
📊 积分进度: 50/60 (还需10)
```

---

### 4. 技术要求

#### 4.1 后台运行
- **需求**: 不受前台操作电脑影响
- **实现方式**:
  - 可选无头模式（headless）
  - 独立窗口运行
  - 不干扰用户其他操作
  
- **用户选择**:
  ```
  是否使用后台模式运行？
    1 - 显示浏览器（推荐，方便观察）
    2 - 后台运行（无窗口）
  ```

#### 4.2 环境配置
- **Conda环境**: `fs_dev_ts_gpu`
- **依赖包**:
  ```
  selenium >= 4.15.0
  webdriver-manager >= 4.0.1
  ```

#### 4.3 进度保存
- **保存文件**: `learning_progress.json`
- **功能**: 
  - 记录已完成课程URL
  - 支持断点续学
  - 避免重复学习

#### 4.4 日志记录
- **日志文件**: `auto_academy.log`
- **记录内容**:
  - 操作步骤
  - 错误信息
  - 积分变化
  - 时间统计

---

### 5. 代码文件要求

#### 5.1 文件操作规范
- ✅ **直接修改现有代码文件**
- ❌ **不创建新的代码文件**（除非必要）
- ❌ **不创建MD说明文档**（用户不需要）
- ✅ **代码中包含详细注释**

#### 5.2 现有文件
```
auto_academy.py          # 主程序（需修改）
config.py               # 配置文件
requirements.txt        # 依赖列表
learning_progress.json  # 进度记录（自动生成）
auto_academy.log       # 日志文件（自动生成）
```

---

## 🎯 完整工作流程

```
第1步: 启动程序
  ↓
第2步: 初始化浏览器（配置反检测）
  ↓
第3步: 自动登录
  ├─ 输入账号密码
  ├─ 模拟人类输入
  └─ 验证登录成功
  ↓
第4步: 查询当前积分
  ├─ 访问积分页面
  ├─ 提取"本年累计"数字
  └─ 判断是否已达60分
      ├─ 已达标 → 退出程序
      └─ 未达标 → 继续
  ↓
第5步: 获取课程列表
  ├─ 访问在线课堂
  ├─ 滚动加载所有课程
  ├─ 提取课程信息（标题、URL、学分）
  └─ 按学分从高到低排序
  ↓
第6步: 循环学习课程
  ├─ 打开课程页面
  ├─ 检测课程类型（视频/文档）
  ├─ 视频课程:
  │   ├─ 自动播放
  │   ├─ 设置2倍速
  │   └─ 等待倒计时
  ├─ 文档课程:
  │   ├─ 快速翻页
  │   └─ 等待倒计时
  ├─ 倒计时监控:
  │   ├─ 每10秒检查一次
  │   ├─ 显示剩余时间
  │   └─ 倒计时为0时继续
  ├─ 记录获得积分
  ├─ 保存完成进度
  └─ 检查总积分是否达标
      ├─ 已达60分 → 停止学习
      └─ 未达标 → 继续下一课程
  ↓
第7步: 完成
  ├─ 显示统计信息
  ├─ 保存进度
  └─ 关闭浏览器
```

---

## 🔍 关键技术实现

### 倒计时检测与等待

```python
def get_countdown_time():
    """
    提取倒计时剩余秒数
    支持格式:
      - "还需 19分钟 12秒" → 1152秒
      - "05:30" → 330秒
      - "01:05:30" → 3930秒
    """
    # 查找倒计时元素
    countdown_elem = driver.find_element(
        By.CLASS_NAME, 
        "yxtulcdsdk-course-player__countdown"
    )
    text = countdown_elem.text
    
    # 正则提取时间
    patterns = [
        r'(\d+):(\d+):(\d+)',  # HH:MM:SS
        r'(\d+):(\d+)',         # MM:SS
        r'(\d+)\s*分.*?(\d+)\s*秒'  # X分Y秒
    ]
    
    # 转换为总秒数
    return total_seconds

def wait_for_countdown():
    """
    等待倒计时结束
    策略: 每10秒检查一次
    """
    while True:
        remaining = get_countdown_time()
        if remaining == 0:
            return True  # 完成
        
        print(f"⏳ 还需等待: {remaining//60}分{remaining%60}秒")
        time.sleep(10)  # 每10秒检查
```

### 积分检测与智能停止

```python
def check_credit():
    """检查当前积分"""
    driver.get("https://academy.famsungroup.com/ssp/#/credit/userdetail")
    
    # 查找"本年累计"区域
    elem = driver.find_element(
        By.XPATH, 
        "//div[contains(text(), '本年累计')]//following::span"
    )
    
    # 提取数字
    credit = float(re.search(r'(\d+\.?\d*)', elem.text).group(1))
    return credit

def auto_learn_with_credit():
    """智能学习模式"""
    current_credit = check_credit()
    
    if current_credit >= 60:
        print("🎉 已达标，无需学习")
        return
    
    courses = get_all_courses()
    courses.sort(key=lambda x: x['credit'], reverse=True)
    
    earned = 0
    for course in courses:
        play_course(course)
        earned += course['credit']
        
        if current_credit + earned >= 60:
            print("🎉 达到60分目标！")
            break
```

---

## ⚠️ 重要注意事项

### 1. 倒计时是硬性约束
- 系统强制要求，无法绕过
- 必须耐心等待
- 2倍速播放只是加快视频，不影响倒计时

### 2. 积分策略的重要性
- 优先高分课程可节省70%时间
- 达标后立即停止，不浪费时间
- 实时监控进度

### 3. 反检测措施
- 必须去除webdriver标识
- 模拟人类操作（随机延迟）
- 使用真实User-Agent

### 4. 异常处理
- 网络波动
- 元素加载延迟
- 页面结构变化

---

## 📊 预期效果

### 时间估算
```
假设需要达到60学分:
- 不使用智能策略: 
  学完100个课程，每个20分钟 = 33小时

- 使用智能策略:
  学完20个高分课程，每个20分钟 = 6.7小时
  
节省时间: 26.3小时 (约80%)
```

### 自动化程度
- ✅ 100% 自动登录
- ✅ 100% 自动选课
- ✅ 100% 自动播放
- ✅ 100% 等待倒计时
- ✅ 100% 积分监控
- ✅ 100% 智能停止

### 用户操作
- **启动前**: 运行程序，选择模式
- **运行中**: 无需操作（可后台运行）
- **完成后**: 查看日志和结果

---

## 🎯 当前实现状态

### ✅ 已完成功能
- [x] 自动登录系统
- [x] 课程列表获取
- [x] 倒计时检测
- [x] 倒计时等待机制
- [x] 视频2倍速播放
- [x] 文档快速浏览
- [x] 积分查询
- [x] 课程按积分排序
- [x] 智能停止（60分）
- [x] 进度保存
- [x] 详细日志

### 🔧 需要验证
- [ ] 元素定位器准确性（需实际测试）
- [ ] 积分提取逻辑正确性
- [ ] 倒计时解析完整性
- [ ] 各类课程类型兼容性

### 📝 优化方向
- [ ] 增加重试机制
- [ ] 优化等待时间
- [ ] 增强错误处理
- [ ] 添加通知功能（完成后提醒）

---

**文档版本**: v2.1  
**最后更新**: 2025年10月20日  
**核心特性**: 倒计时强制等待 + 智能积分优化
